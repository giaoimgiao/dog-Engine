# 社区角色卡分享功能使用指南

## 功能说明

社区角色卡分享功能允许用户将自己创作的AI角色设定分享给其他人。系统支持两种分享模式：

### 1. 本地分享（默认）
- **保存位置**：仅保存在本地 `src/data/community-prompts.json`
- **可见范围**：仅当前部署的实例可见
- **无需登录**：直接保存即可

### 2. 远程分享（需登录）
- **保存位置**：同时保存到本地 + 上传到远程服务器
- **可见范围**：所有部署此项目的用户都能看到
- **需要登录**：必须先登录远程服务器

## 使用步骤

### 本地分享（无需登录）

1. 访问**创作社区**页面（`/community`）
2. 点击右上角的**"分享我的设定"**按钮
3. 填写角色名称和角色设定
4. 选择**"公开分享"**或**"仅自己可见"**
5. **不勾选**"上传到远程服务器"
6. 点击**发布**

✅ 角色卡将保存到本地，只有你能看到。

### 远程分享（需要登录）

#### 第一步：登录远程服务器

1. 访问**社区快速上传**页面（`/community/upload`）
2. 在"服务器与登录"区域：
   - 服务器地址默认为：`http://47.95.220.140`
   - 输入用户名和密码
   - 点击**"注册"**（首次使用）或**"登录"**
3. 看到"已登录"提示即表示成功

#### 第二步：上传角色卡

**方式一：在创作社区页面上传**

1. 访问**创作社区**页面（`/community`）
2. 点击右上角的**"分享我的设定"**按钮
3. 填写角色名称和角色设定
4. 选择**"公开分享"**
5. **勾选**"上传到远程服务器"（只有登录后才能勾选）
6. 点击**发布**

✅ 角色卡将同时保存到本地和远程服务器，所有用户都能看到！

**方式二：在社区快速上传页面上传**

1. 访问**社区快速上传**页面（`/community/upload`）
2. 登录后，在"发布提示词"区域：
   - 填写名称和提示词
   - 选择"公开可见"
   - 点击**发布**

✅ 角色卡将上传到远程服务器，所有用户都能看到！

## 上传结果说明

### 成功提示

- **✅ 发布成功！** 
  - 已保存到本地并成功上传到远程服务器，所有用户都能看到！

### 部分成功提示

- **⚠️ 部分成功** 
  - 已保存到本地，但远程上传失败：[错误原因]
  - 说明：角色卡已保存到本地，但由于某些原因（如网络问题、服务器故障）未能上传到远程服务器

### 失败提示

- **❌ 发布失败** 
  - 本地保存失败 / 服务器错误 / 网络错误

## 常见问题

### Q: 为什么"上传到远程服务器"开关是灰色的？
A: 你还没有登录远程服务器。请先访问 `/community/upload` 页面进行注册和登录。

### Q: 我已经登录了，为什么上传还是失败？
A: 可能的原因：
1. 远程服务器无法访问（`http://47.95.220.140`）
2. Token已过期，需要重新登录
3. 网络连接问题

**解决方法**：
1. 检查控制台日志（F12）查看详细错误信息
2. 尝试重新登录
3. 检查网络连接和服务器状态

### Q: 如何查看所有人分享的角色卡？
A: 访问**创作社区**页面（`/community`），系统会自动从远程服务器获取所有公开的角色卡。

### Q: 我能编辑或删除已上传的角色卡吗？
A: 
- **本地角色卡**：可以直接编辑和删除
- **远程角色卡**：只有创建者本人（登录状态下）可以编辑和删除

### Q: 本地和远程有什么区别？
A: 
- **本地**：数据保存在 `src/data/community-prompts.json`，只有当前部署实例可见
- **远程**：数据保存在远程服务器（内存中），所有连接到该服务器的实例都能看到

## 架构说明

```
┌─────────────────┐
│   用户浏览器     │
└────────┬────────┘
         │
         ├──► 本地保存: src/data/community-prompts.json
         │
         └──► 远程上传: Next.js API Forward
                  │
                  ▼
          ┌──────────────────────┐
          │  /api/community/forward │
          └──────────┬──────────────┘
                     │
                     ▼
          ┌─────────────────────┐
          │  远程社区服务器      │
          │  (47.95.220.140)    │
          │  Express.js服务     │
          └─────────────────────┘
```

## 环境变量配置

如果你要自己部署远程服务器，可以设置环境变量：

```bash
# .env.local
COMMUNITY_REMOTE_BASE=http://your-server-ip:port
```

## 服务器部署

如果你想运行自己的社区服务器：

1. 进入 `server/community` 目录
2. 安装依赖：`npm install`
3. 启动服务器：`node server.js`
4. 默认端口：8080

默认管理员账号：
- 用户名：`giao`
- 密码：`zhang666666`

可以通过环境变量修改：
```bash
ADMIN_USER=your_admin
ADMIN_PASS=your_password
PORT=8080
JWT_SECRET=your_secret
```

## 技术细节

- 本地存储：使用 `fs` 模块读写 JSON 文件
- 远程存储：内存存储（重启后数据丢失，生产环境建议使用数据库）
- 认证方式：JWT Token（7天有效期）
- 转发机制：Next.js API Route 转发到 Express 服务器

---

如有问题，请查看控制台日志或联系开发者。

